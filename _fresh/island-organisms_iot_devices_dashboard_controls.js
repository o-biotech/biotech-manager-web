import{a as J}from"./chunk-TNQJOQ5Q.js";import{e as N,k as $}from"./chunk-KCNMIE7P.js";import{b as M}from"./chunk-DNDTA3TT.js";import{a as b,b as j,d as C}from"./chunk-2F7KZXGB.js";import"./chunk-JTGYPTKE.js";import{b as I}from"./chunk-HONOQO4B.js";import"./chunk-SZR6QYMX.js";import{b as s}from"./chunk-LVFTG2KX.js";import{a as e}from"./chunk-F4TDH6VI.js";import{a as r,b as w,c as f}from"./chunk-7CC3ABIV.js";import"./chunk-2GUEMEWN.js";import{d as L}from"./chunk-EEB6LQGP.js";import"./chunk-DQW7DUIU.js";function P(a){let i=Object.prototype.toString.call(a);return a instanceof Date||typeof a=="object"&&i==="[object Date]"?new a.constructor(+a):typeof a=="number"||i==="[object Number]"||typeof a=="string"||i==="[object String]"?new Date(a):new Date(NaN)}function H(a,i,v){let g;return se(i)?g=i:v=i,new Intl.DateTimeFormat(v?.locale,g).format(P(a))}function se(a){return a!==void 0&&!("locale"in a)}function he(a){let i=e(L,{children:[e("div",{class:"font-bold text-lg",children:"Loading device data"}),e($,{...a,class:s(["-:w-6 -:h-6 -:text-blue-500 -:animate-spin -:inline-block -:m-4"],a)})]});if(!M)return i;let v=f(null),g=f(null),R=f(null),T=f(null),[c,x]=r("devices"),[o,p]=r("payloads"),[y,Q]=r(""),[E,oe]=r(!0),[k,B]=r(100),[D,U]=r(!0),[h,X]=r(!0),[d,K]=r(Object.keys(a.devices).map(t=>({DeviceID:t,Active:!1,Details:a.devices[t].Details}))),[m,z]=r(""),[S,W]=r([]),[Z,A]=r(!1),[F,_]=r(void 0),G=t=>{let l=d.find(u=>u.DeviceID===t.currentTarget.id);l.Active=!l.Active,K([...d])},V=t=>{Q(v.current.value)},Y=t=>{B(Number.parseInt(g.current.value)),U(R.current.checked),X(T.current.checked)},ee=async()=>{A(!0);let t=`${location.origin}/api/data/warm/explorer`,l={Query:m};console.log(l);let O=(await(await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${a.jwt}`},body:JSON.stringify(l)})).json()).primaryResults[0].data;console.log(O[0]),W(O),setTimeout(()=>{A(!1)},0)};w(()=>{let t=`Devices
| order by EnqueuedTime ${h?"desc":"asc"}`;d.every(l=>!l.Active)||(t=`let deviceIds = dynamic([${d.filter(n=>n.Active).map(n=>`'${n.DeviceID}'`).join(",")}]);
${t}
| where DeviceID in (deviceIds)`),y&&(t=`${t}
${y}`),D&&(t=`${t}
| take ${k}`),z(t)},[y,d,E,k,D,h]);let q=()=>{ee().then()};w(()=>{E&&m&&(F&&clearInterval(F),_(setInterval(q,3e4)),q())},[m]);let te=e("div",{class:"h-full relative overflow-hidden",children:e("div",{class:"h-full relative overflow-auto",children:d.map(t=>e("div",{class:"flex flex-row items-center",children:[e(b,{id:t.DeviceID,name:t.DeviceID,type:"checkbox",checked:t.Active,onClick:G,class:"flex-none mt-1 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600 peer"}),e("label",{for:t.DeviceID,class:"ml-2 flex-1 text-lg peer-checked:font-bold",children:t.Details.Name})]}))})}),ae=c==="devices"?te:c==="settings"?e("div",{class:"h-full relative overflow-hidden",children:e("div",{class:"h-full relative overflow-auto",children:[e("div",{class:"flex flex-row items-center mt-2",children:[e(b,{id:"takeRowsEnabled",name:"takeRowsEnabled",type:"checkbox",checked:D,ref:R,class:"peer flex-none mt-1 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e("label",{for:"takeRowsEnabled",class:"ml-2 flex-1 text-lg peer-checked:font-bold",children:"Use Take Rows"}),e(b,{id:"takeRows",name:"takeRows",type:"number",value:k,ref:g,class:"hidden peer-checked:block flex-1 bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 rounded leading-tight focus:outline-none focus:border-blue-500"})]}),e("div",{class:"flex flex-row items-center m-2",children:e(j,{ref:T,checked:h,children:"Use Descending Order"})}),e("div",{class:"flex flex-row",children:[e("div",{class:"flex-1"}),e(I,{class:"mt-2",onClick:Y,children:"Apply"})]})]})}):c==="custom"?e("div",{class:"h-full relative overflow-hidden",children:e("div",{class:"h-full relative overflow-auto",children:e("div",{class:"flex flex-col",children:[e("label",{for:"custom-filters",class:"ml-2 flex-1 text-lg peer-checked:font-bold",children:"Custom Filters"}),e(b,{id:"custom-filters",name:"custom-filters",type:"text",value:y,ref:v,multiline:!0,class:"appearance-none block w-full bg-white border border-gray-400 hover:border-gray-500 px-4 py-2 rounded leading-tight focus:outline-none focus:border-blue-500"}),e("div",{class:"flex flex-row",children:[e("div",{class:"flex-1"}),e(I,{class:"mt-2",onClick:V,children:"Apply"})]})]})})}):void 0,re=e("div",{class:"h-full relative overflow-hidden",children:e("div",{class:"h-full relative overflow-auto",children:e("pre",{children:JSON.stringify(S,null,2)})})}),le=e("div",{class:"flex flex-col divide-y divide-gray-300 dark:divide-gray-700 h-full relative overflow-hidden",children:[e("div",{class:"flex-1 flex flex-row p-2",children:[e("div",{class:"flex-none w-40 underline",children:"Device ID"}),e("div",{class:"flex-1 underline",children:"Processed At"}),e("div",{class:"flex-none w-40 underline"})]}),e("div",{class:"flex flex-col divide-y divide-gray-300 dark:divide-gray-700 h-full relative overflow-auto",children:S.map(t=>{let l=H(new Date(Date.parse(t.EnqueuedTime)),{timeZoneName:"longOffset",year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3}),u=JSON.stringify(t.RawData,null,2),n=t.DeviceID+Date.parse(t.EnqueuedTime);return e("div",{class:"flex-1 flex flex-wrap items-center p-2",children:[e("div",{class:"flex-none w-40",children:t.DeviceID}),e("div",{class:"flex-1",children:l}),e("div",{class:"flex-none",children:e(J,{class:"hidden",value:u})}),e("input",{id:n,type:"checkbox",class:"sr-only peer"}),e("label",{for:n,class:"cursor-pointer transition-all duration-200 peer-checked:rotate-[-180deg]",children:e(N,{class:"w-6 h-6"})}),e("div",{class:"hidden peer-checked:block w-full m-2 p-2 shadow shadow-inner bg-gray-200 dark:bg-gray-700",children:e("pre",{children:u})})]},n)})})]}),ie=o==="raw"?re:o==="payloads"?le:o==="streaming"?e("h1",{class:"text-2xl",children:"Coming Soon"}):o==="query"?e("div",{class:"h-full relative overflow-hidden",children:e("div",{class:"h-full relative overflow-auto",children:e("pre",{children:m})})}):void 0;return e("div",{class:"flex flex-col gap-4 divide-y-4 divide-[#4a918e]",children:[e("h1",{class:"text-4xl",children:"Device Data"}),e("div",{class:"flex flex-col md:flex-row gap-4 pt-4 relative",children:[e(C,{class:"flex-none w-[25%] p-4 bg-slate-50 dark:bg-slate-800 shadow shadow-slate-500 dark:shadow-black",children:[e("h1",{class:"text-2xl mb-1",children:"Filters"}),e("ul",{class:"flex flex-wrap text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:border-gray-700 dark:text-gray-400",children:[e("li",{class:"me-2",children:e("a",{onClick:()=>x("devices"),"aria-current":"page",class:s(["inline-block p-2 rounded-t-lg cursor-pointer",c==="devices"?"active bg-gray-700 dark:bg-gray-300 text-blue-300 dark:text-blue-700":"bg-gray-300 dark:bg-gray-700 text-blue-700 dark:text-blue-300"]),children:"Devices"})}),e("li",{class:"me-2",children:e("a",{onClick:()=>x("settings"),"aria-current":"page",class:s(["inline-block p-2 rounded-t-lg cursor-pointer",c==="settings"?"active bg-gray-700 dark:bg-gray-300 text-blue-300 dark:text-blue-700":"bg-gray-300 dark:bg-gray-700 text-blue-700 dark:text-blue-300"]),children:"Settings"})}),e("li",{class:"me-2",children:e("a",{onClick:()=>x("custom"),"aria-current":"page",class:s(["inline-block p-2 rounded-t-lg cursor-pointer",c==="custom"?"active bg-gray-700 dark:bg-gray-300 text-blue-300 dark:text-blue-700":"bg-gray-300 dark:bg-gray-700 text-blue-700 dark:text-blue-300"]),children:"Custom"})})]}),ae]}),e(C,{class:"flex-1 p-4 bg-slate-100 dark:bg-slate-800 shadow shadow-slate-500 dark:shadow-black",children:[e("ul",{class:"flex flex-wrap text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:border-gray-700 dark:text-gray-400",children:[e("li",{class:"me-2",children:e("a",{onClick:()=>p("payloads"),"aria-current":"page",class:s(["inline-block p-4 rounded-t-lg cursor-pointer",o==="payloads"?"active bg-gray-700 dark:bg-gray-300 text-blue-300 dark:text-blue-700":"bg-gray-300 dark:bg-gray-700 text-blue-700 dark:text-blue-300"]),children:"Payloads"})}),e("li",{class:"me-2",children:e("a",{onClick:()=>p("streaming"),"aria-current":"page",class:s(["inline-block p-4 rounded-t-lg cursor-pointer",o==="streaming"?"active bg-gray-700 dark:bg-gray-300 text-blue-300 dark:text-blue-700":"bg-gray-300 dark:bg-gray-700 text-blue-700 dark:text-blue-300"]),children:"Streaming"})}),e("li",{class:"me-2",children:e("a",{onClick:()=>p("raw"),"aria-current":"page",class:s(["inline-block p-4 rounded-t-lg cursor-pointer",o==="raw"?"active bg-gray-700 dark:bg-gray-300 text-blue-300 dark:text-blue-700":"bg-gray-300 dark:bg-gray-700 text-blue-700 dark:text-blue-300"]),children:"Raw JSON"})}),e("li",{class:"me-2",children:e("a",{onClick:()=>p("query"),"aria-current":"page",class:s(["inline-block p-4 rounded-t-lg cursor-pointer",o==="query"?"active bg-gray-700 dark:bg-gray-300 text-blue-300 dark:text-blue-700":"bg-gray-300 dark:bg-gray-700 text-blue-700 dark:text-blue-300"]),children:"Current Query"})})]}),Z&&e("div",{class:"w-full",children:e("div",{class:"h-1.5 w-full bg-sky-100 overflow-hidden",children:e("div",{class:"animate-progress w-full h-full bg-sky-500 origin-left-right"})})}),e("div",{class:"m-2 h-[450px]",children:ie})]})]})]})}export{he as DevicesDashboardControls};
