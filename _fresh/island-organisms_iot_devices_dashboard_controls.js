import{a as S}from"./chunk-3IXZISW4.js";import{e as k,k as I}from"./chunk-L7FNLU2O.js";import{b as h}from"./chunk-CO2DYHC4.js";import{a as C,d as p}from"./chunk-HYNSP3Y5.js";import"./chunk-HADJFUJY.js";import"./chunk-JJVNKJR6.js";import"./chunk-WKHZVTXF.js";import{a as d}from"./chunk-FVURMPBZ.js";import{a as e}from"./chunk-BRQEXE2C.js";import{a as n,b as w}from"./chunk-IN5SKDVW.js";import"./chunk-2GUEMEWN.js";import{d as x}from"./chunk-BV6DNIGX.js";import"./chunk-DQW7DUIU.js";function A(t){let r=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&r==="[object Date]"?new t.constructor(+t):typeof t=="number"||r==="[object Number]"||typeof t=="string"||r==="[object String]"?new Date(t):new Date(NaN)}function E(t,r,l){let o;return F(r)?o=r:l=r,new Intl.DateTimeFormat(l?.locale,o).format(A(t))}function F(t){return t!==void 0&&!("locale"in t)}function _(t){let r=e(x,{children:[e("div",{class:"font-bold text-lg",children:"Loading device data"}),e(I,{...t,class:d(["-:w-6 -:h-6 -:text-blue-500 -:animate-spin -:inline-block -:m-4"],t)})]});if(!h)return r;let[l,o]=n("payloads"),[v,J]=n(!0),[s,R]=n(Object.keys(t.devices).map(a=>({DeviceID:a,Active:!1,Details:t.devices[a].Details}))),[D,T]=n([]),[O,m]=n(!1),j=a=>{let i=s.find(c=>c.DeviceID===a.currentTarget.id);i.Active=!i.Active,R(s),console.log("set device active"),console.log(s),y().then()},y=async()=>{m(!0);let a=`${location.origin}/api/data/warm/explorer`,i={Query:`Devices
| order by EnqueuedTime desc
| take 100`};if(!s.every(f=>!f.Active)){let f=s.filter(g=>g.Active);i.Query=`let deviceIds = dynamic([${f.map(g=>`'${g.DeviceID}'`).join(",")}]);
${i.Query}
| where DeviceID in (deviceIds)`}console.log(i);let b=(await(await fetch(a,{method:"POST",headers:{Authorization:`Bearer ${t.jwt}`},body:JSON.stringify(i)})).json()).primaryResults[0].data;console.log(b[0]),T(b),setTimeout(()=>{m(!1)},0)};w(()=>{if(v){let a=()=>{y().then(()=>{v||clearInterval(i)})},i=setInterval(a,3e4);a()}},[s,v]);let q=e("div",{class:"h-full relative overflow-hidden",children:e("div",{class:"h-full relative overflow-auto",children:e("pre",{children:JSON.stringify(D,null,2)})})}),N=e("div",{class:"flex flex-col divide-y divide-gray-300 dark:divide-gray-700 h-full relative overflow-hidden",children:[e("div",{class:"flex-1 flex flex-row p-2",children:[e("div",{class:"flex-none w-40 underline",children:"Device ID"}),e("div",{class:"flex-1 underline",children:"Processed At"}),e("div",{class:"flex-none w-40 underline"})]}),e("div",{class:"flex flex-col divide-y divide-gray-300 dark:divide-gray-700 h-full relative overflow-auto",children:D.map(a=>{let i=E(new Date(Date.parse(a.EnqueuedTime)),{timeZoneName:"longOffset",year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",fractionalSecondDigits:3}),c=JSON.stringify(a.RawData,null,2),u=a.DeviceID+a.EnqueuedTime+"-open";return e("div",{class:"flex-1 flex flex-wrap items-center p-2",children:[e("div",{class:"flex-none w-40",children:a.DeviceID}),e("div",{class:"flex-1",children:i}),e("div",{class:"flex-none",children:e(S,{class:"hidden",value:c})}),e("input",{id:u,type:"checkbox",class:"sr-only peer"}),e("label",{for:u,class:"cursor-pointer transition-all duration-200 peer-checked:rotate-[-180deg]",children:e(k,{class:"w-6 h-6"})}),e("div",{class:"hidden peer-checked:block w-full m-2 p-2 shadow shadow-inner bg-gray-200 dark:bg-gray-700",children:e("pre",{children:c})})]})})})]}),P=l==="raw"?q:l==="payloads"?N:l==="streaming"?e("h1",{class:"text-2xl",children:"Coming Soon"}):void 0;return e("div",{class:"flex flex-col md:flex-row gap-4",children:[e(p,{class:"flex-none md:w-[33%] p-4 bg-slate-50 dark:bg-slate-800 shadow shadow-slate-500 dark:shadow-black",children:[e("h1",{class:"text-2xl mb-1",children:"Devices"}),s.map(a=>e("div",{class:"flex flex-row items-center",children:[e(C,{id:a.DeviceID,name:a.DeviceID,type:"checkbox",checked:a.Active,onClick:j,class:"flex-none mt-1 w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e("label",{for:a.DeviceID,class:"ml-1 flex-1 text-xl",children:a.Details.Name})]}))]}),e(p,{class:"flex-1 p-4 bg-slate-100 dark:bg-slate-800 shadow shadow-slate-500 dark:shadow-black",children:[e("ul",{class:"flex flex-wrap text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:border-gray-700 dark:text-gray-400",children:[e("li",{class:"me-2",children:e("a",{onClick:()=>o("payloads"),"aria-current":"page",class:d(["inline-block p-4 rounded-t-lg cursor-pointer",l==="payloads"?"active bg-gray-700 dark:bg-gray-300 text-blue-300 dark:text-blue-700":"bg-gray-300 dark:bg-gray-700 text-blue-700 dark:text-blue-300"]),children:"Payloads"})}),e("li",{class:"me-2",children:e("a",{onClick:()=>o("streaming"),"aria-current":"page",class:d(["inline-block p-4 rounded-t-lg cursor-pointer",l==="streaming"?"active bg-gray-700 dark:bg-gray-300 text-blue-300 dark:text-blue-700":"bg-gray-300 dark:bg-gray-700 text-blue-700 dark:text-blue-300"]),children:"Streaming"})}),e("li",{class:"me-2",children:e("a",{onClick:()=>o("raw"),"aria-current":"page",class:d(["inline-block p-4 rounded-t-lg cursor-pointer",l==="raw"?"active bg-gray-700 dark:bg-gray-300 text-blue-300 dark:text-blue-700":"bg-gray-300 dark:bg-gray-700 text-blue-700 dark:text-blue-300"]),children:"Raw JSON"})})]}),O&&e("div",{class:"w-full",children:e("div",{class:"h-1.5 w-full bg-sky-100 overflow-hidden",children:e("div",{class:"animate-progress w-full h-full bg-sky-500 origin-left-right"})})}),e("div",{class:"m-2 max-h-[100vh] h-full",children:P})]})]})}export{_ as DevicesDashboardControls};
