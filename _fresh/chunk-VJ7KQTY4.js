import{k as i}from"./chunk-DOF2CREV.js";import{b as m}from"./chunk-SAMFL3P4.js";import{b as h}from"./chunk-JJVNKJR6.js";import{a as e}from"./chunk-BRQEXE2C.js";import{a as n,c as b}from"./chunk-IN5SKDVW.js";import{d as s}from"./chunk-BV6DNIGX.js";function I(r){if(!m)return e(s,{children:e(i,{class:"w-20 h-20 text-blue-500 animate-spin inline-block m-4"})});let l=b(null),[d,f]=n(!1),[c,u]=n(r.dashboardTypes[0]||"");if(r.dashboardTypes.includes("AzureDataExplorer")){let a=t=>{switch(t){case"query":return["https://kwetest.eastus.kusto.windows.net/.default"];case"People.Read":return["People.Read","User.ReadBasic.All","Group.Read.All"];default:return[t]}},x=(t,o)=>{console.log(`[postToken] scope: ${o}, message length(accesstoken): ${t.length}`),f(!0),l.current?.contentWindow?.postMessage({type:"postToken",message:t,scope:o},"*")},w=async t=>{let o=a(t),T=`${location.origin}/api/data/clouds/auth-token?scope=${o.join(",")}`,g=await(await fetch(T,{headers:{Authorization:`Bearer ${r.jwt}`}})).json();console.log(g),x(g.Token,t)};self.addEventListener("message",t=>{console.log(t.data.type),t.data.signature==="queryExplorer"&&t.data.type==="getToken"&&w(t.data.scope).then()})}let p=r.dashboardTypes.includes("AzureDataExplorer")?`https://dataexplorer.azure.com/clusters/${r.kustoCluster}.${r.kustoLocation}/databases/Telemetry?f-IFrameAuth=true&f-UseMeControl=false&workspace=<guid>`:null,y=p&&e(s,{children:[!d&&e(i,{class:"w-20 h-20 text-blue-500 animate-spin inline-block m-4"}),d&&e("p",{children:["If you receive an error about failure to read 'localStorage' visit"," ",e(h,{class:"inline-block",actionStyle:4,href:"https://www.chromium.org/for-testers/bug-reporting-guidelines/uncaught-securityerror-failed-to-read-the-localstorage-property-from-window-access-is-denied-for-this-document/#:~:text=This%20exception%20is%20thrown%20when,the%20fourth%20item%20under%20Cookies.",target:"_blank",children:"this"})," ","page to fix."]}),e("iframe",{class:"w-full h-[600px]",ref:l,src:p})]}),k=c==="AzureDataExplorer"?y:c==="Freeboard"?e("div",{children:"Freeboard coming soon"}):e("div",{children:"No dashboards configured"});return e(s,{children:[e("ul",{class:"flex flex-wrap text-sm font-medium text-center text-gray-500 border-b border-gray-200 dark:border-gray-700 dark:text-gray-400",children:[r.dashboardTypes.some(a=>a==="AzureDataExplorer")&&e("li",{class:"me-2",children:e("a",{onClick:()=>u("AzureDataExplorer"),"aria-current":"page",class:"inline-block p-4 text-blue-600 bg-gray-100 rounded-t-lg active dark:bg-gray-800 dark:text-blue-500",children:"Azure Data Explorer"})}),r.dashboardTypes.some(a=>a==="Freeboard")&&e("li",{class:"me-2",children:e("a",{onClick:()=>u("Freeboard"),"aria-current":"page",class:"inline-block p-4 text-blue-600 bg-gray-100 rounded-t-lg active dark:bg-gray-800 dark:text-blue-500",children:"Freeboard"})})]}),k]})}export{I as a};
